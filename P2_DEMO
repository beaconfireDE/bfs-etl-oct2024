
import os
from datetime import datetime

from airflow import DAG
from airflow.providers.snowflake.operators.snowflake import SnowflakeOperator

SNOWFLAKE_CONN_ID = 'snowflake_conn'
SNOWFLAKE_DATABASE = 'beaconfire'
SNOWFLAKE_SCHEMA = 'dev_db'
SNOWFLAKE_ROLE = 'AW_developer'
SNOWFLAKE_WAREHOUSE = 'BF_ETL1007'

CREATE_TABLE_DIM_STOCK_STATIC = f"""
CREATE TABLE IF NOT EXISTS {SNOWFLAKE_DATABASE}.{SNOWFLAKE_SCHEMA}.DIM_STOCK_STATIC_5 (
    SYMBOL VARCHAR PRIMARY KEY,
    EXCHANGE VARCHAR
);
"""

CREATE_TABLE_SCD_COMPANY_PROFILE = f"""
CREATE TABLE IF NOT EXISTS {SNOWFLAKE_DATABASE}.{SNOWFLAKE_SCHEMA}.DIM_SCD_COMPANY_PROFILE_5 (
    SCD_ID NUMBER PRIMARY KEY,
    SYMBOL VARCHAR,
    NAME VARCHAR,
    COMPANYNAME VARCHAR,
    WEBSITE VARCHAR,
    PRICE FLOAT,
    BETA FLOAT,
    VOLAVG INT,
    MKTCAP FLOAT,
    LASTDIV FLOAT,
    RANGE VARCHAR,
    CHANGES FLOAT,
    CEO VARCHAR,
    INDUSTRY VARCHAR,
    SECTOR VARCHAR,
    DESCRIPTION VARCHAR,
    DCFDIFF FLOAT,
    DCF FLOAT,
    Start_Date DATE,
    End_Date DATE
);
"""

CREATE_TABLE_FACT_STOCK_HISTORY = f"""
CREATE TABLE IF NOT EXISTS {SNOWFLAKE_DATABASE}.{SNOWFLAKE_SCHEMA}.FACT_STOCK_HISTORY_5 (
    SYMBOL VARCHAR,
    DATE DATE,
    OPEN FLOAT,
    HIGH FLOAT,
    LOW FLOAT,
    CLOSE FLOAT,
    VOLUME INT,
    ADJCLOSE FLOAT
);
"""


with DAG(
    'Project_2_team5',
    start_date=datetime(2024, 11, 4),
    schedule_interval='0 15 * * *',
    default_args={'snowflake_conn_id': SNOWFLAKE_CONN_ID},
    tags=['beaconfire_TEAM5'],
    catchup=False,
) as dag:
































